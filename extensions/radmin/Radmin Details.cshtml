@inherits AppCode.Razor.AppRazor
@using ToSic.Razor.Blade
@using AppCode
@using AppCode.Data
@using AppCode.Extensions.Radmin
@using ToSic.Sxc.Data;

@{
  var viewId = MyModel.Get<string>("viewId");
  var entityId = MyPage.Parameters.Int(
    SxcTablesConstants.UrlParamEntityId
  );

  if (!Text.Has(viewId) || entityId <= 0)
  {
    <div class="alert alert-warning">
      Missing parameters.
    </div>
    return;
  }

  var backPageParameters = MyPage.Parameters.Flush();

  var radminDetails = App.Data.GetAll<RadminDetails>()
    .Where(d => d.ViewId == viewId)
    .FirstOrDefault();

  var entitiyStream = App.Data.GetStream(
    radminDetails.DataContentType
  );

  var entity = AsItems(entitiyStream)
    .FirstOrDefault(e => e.Id == entityId);

  var entityContentType = App.Data.GetContentType(
    radminDetails.DataContentType
  );
}

@if (entity == null)
{
  <div class="alert alert-warning">
    Entity not found in provided datasource.
  </div>
  return;
}

<div @Kit.Toolbar.Empty().Edit(entity)>
  <h2>@entity.Get("Title")</h2>

  <table class="table table-bordered mt-4">
    <tbody>
      @foreach (var attr in entityContentType.Attributes)
      {
        var key = attr.Name;
        var value = entity.Get(key);
        // Determine if current attr is a group title (starts with "Group" and has no value)
        var isGroupTitle = key.StartsWith("Group") && !Text.Has(value);
        // Group titles should be rendered bold
        var groupTitleClass = isGroupTitle ? "fw-bold" : "fw-normal";
        
        <tr>
          <th class="w-25 @groupTitleClass">
            @key
          </th>
          <td>
            @value
          </td>
        </tr>
      }
    </tbody>
  </table>
  
  <a
    href="@Link.To(
      parameters: backPageParameters
    )"
    class="btn btn-primary mt-3"
  >
    Back to Table View
  </a>
</div>
